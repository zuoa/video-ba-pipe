<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPU需求计算器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .form-section {
            background: #f5f5f5;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .form-group select,
        .form-group input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s;
            background: white;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #000000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .slider-group {
            margin-bottom: 20px;
        }

        .slider-group label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
            color: #555;
        }

        .slider-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
        }

        .slider-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #000000;
            cursor: pointer;
            border: none;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #000000 0%, #333333 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .calculate-btn:active {
            transform: translateY(0);
        }

        .formula-box {
            background: linear-gradient(135deg, #1a1a1a 0%, #333333 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: none;
            border: 2px solid #444;
        }

        .formula-box h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        .formula-content {
            background: rgba(255,255,255,0.2);
            padding: 25px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            font-family: 'Courier New', monospace;
            line-height: 2;
        }

        .formula-step {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }

        .formula-step strong {
            display: block;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .results {
            display: none;
        }

        .results h2 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 25px;
            text-align: center;
        }

        .gpu-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .gpu-card {
            background: linear-gradient(135deg, #000000 0%, #2d2d2d 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #444;
        }

        .gpu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-color: #666;
        }

        .gpu-card h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }

        .gpu-card .spec {
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gpu-card .spec-label {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .gpu-card .spec-value {
            font-weight: 700;
            font-size: 1.1em;
        }

        .gpu-card .card-count {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid rgba(255,255,255,0.3);
            text-align: center;
        }

        .gpu-card .card-count-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .gpu-card .card-count-value {
            font-size: 3em;
            font-weight: 700;
            line-height: 1;
        }

        .gpu-card .card-count-unit {
            font-size: 0.5em;
            opacity: 0.9;
        }

        .summary-box {
            background: #f5f5f5;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .summary-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .summary-box p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            border-radius: 8px;
            color: #333;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .info-box ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .info-box li {
            margin-bottom: 5px;
        }

        .highlight {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>GPU需求计算器</h1>
            <p>根据视频需求计算所需GPU卡数量  @YuJian</p>
        </div>

        <div class="content">
            <div class="form-section">
                <h2>视频参数配置</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="streams">视频路数</label>
                        <input type="number" id="streams" value="64" min="1" max="1000" step="1">
                    </div>

                    <div class="form-group">
                        <label for="resolution">视频分辨率</label>
                        <select id="resolution">
                            <option value="1">640×640 (标准检测)</option>
                            <option value="1.27">1280×720 (720p HD)</option>
                            <option value="1.5">800×800</option>
                            <option value="2.25">960×960</option>
                            <option value="3.04" selected>1920×1080 (1080p Full HD)</option>
                            <option value="2.8">1080×1080</option>
                            <option value="4">1280×1280</option>
                            <option value="6.25">1600×1600</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="fps">目标FPS</label>
                        <input type="number" id="fps" value="10" min="1" max="60" step="1">
                    </div>

                    <div class="form-group">
                        <label for="model">YOLOv8模型</label>
                        <select id="model">
                            <option value="8.7" selected>YOLOv8n (8.7 GFLOPs) - 超轻量</option>
                            <option value="28.6">YOLOv8s (28.6 GFLOPs) - 轻量</option>
                            <option value="78.9">YOLOv8m (78.9 GFLOPs) - 中等</option>
                            <option value="165.2">YOLOv8l (165.2 GFLOPs) - 大型</option>
                            <option value="257.8">YOLOv8x (257.8 GFLOPs) - 超大型</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="videoDecode">是否包含视频流解码</label>
                        <select id="videoDecode">
                            <option value="false" selected>否 - 仅AI推理</option>
                            <option value="true">是 - 包含H264解码</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="decodeSection" class="form-section" style="display: none;">
                <h2>H264解码参数配置</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="decodeResolution">解码分辨率</label>
                        <select id="decodeResolution">
                            <option value="0.25">640×480 (VGA)</option>
                            <option value="0.5">1280×720 (720p HD)</option>
                            <option value="1" selected>1920×1080 (1080p Full HD)</option>
                            <option value="1.8">2560×1440 (1440p QHD)</option>
                            <option value="2.25">3840×2160 (4K UHD)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="decodeFps">解码帧率</label>
                        <input type="number" id="decodeFps" value="30" min="1" max="60" step="1">
                    </div>

                    <div class="form-group">
                        <label for="decodeComplexity">编码复杂度</label>
                        <select id="decodeComplexity">
                            <option value="1" selected>标准复杂度</option>
                            <option value="1.2">高复杂度 (高码率)</option>
                            <option value="0.8">低复杂度 (低码率)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2>效率参数配置</h2>

                <div class="slider-group">
                    <label>
                        <span>GPU利用率</span>
                        <span id="utilizationValue">75%</span>
                    </label>
                    <input type="range" id="utilization" min="50" max="95" value="75" step="1">
                </div>

                <div class="slider-group">
                    <label>
                        <span>Batch并行效率</span>
                        <span id="batchValue">85%</span>
                    </label>
                    <input type="range" id="batch" min="60" max="95" value="85" step="1">
                </div>

                <div class="slider-group">
                    <label>
                        <span>后处理开销</span>
                        <span id="overheadValue">8%</span>
                    </label>
                    <input type="range" id="overhead" min="0" max="20" value="8" step="1">
                </div>
            </div>

            <button class="calculate-btn" onclick="calculate()">计算GPU需求</button>

            <div id="formulaBox" class="formula-box">
                <h2>计算公式与步骤</h2>
                <div class="formula-content">
                    <div class="formula-step">
                        <strong>步骤1：计算单路视频所需算力</strong>
                        <div id="step1"></div>
                    </div>
                    <div class="formula-step">
                        <strong>步骤2：计算总算力需求</strong>
                        <div id="step2"></div>
                    </div>
                    <div class="formula-step">
                        <strong>步骤3：计算单卡可用算力</strong>
                        <div id="step3"></div>
                    </div>
                    <div class="formula-step">
                        <strong>步骤4：计算所需GPU卡数</strong>
                        <div id="step4"></div>
                    </div>
                </div>
            </div>

            <div id="results" class="results">
                <h2>GPU卡数需求</h2>

                <div class="summary-box">
                    <h3>计算摘要</h3>
                    <p id="summaryText"></p>
                </div>

                <div id="gpuCards" class="gpu-cards"></div>
            </div>

            <div class="info-box">
                <h3>使用说明</h3>
                <ul>
                    <li><strong>视频路数：</strong>需要同时处理的视频流数量</li>
                    <li><strong>视频分辨率：</strong>输入到模型的图像尺寸，影响计算量</li>
                    <li><strong>目标FPS：</strong>每路视频的处理帧率</li>
                    <li><strong>是否包含视频流解码：</strong>选择是否需要在GPU上进行H264视频解码</li>
                    <li><strong>解码分辨率：</strong>H264视频流的原始分辨率，影响解码算力需求</li>
                    <li><strong>解码帧率：</strong>H264视频流的原始帧率</li>
                    <li><strong>编码复杂度：</strong>H264编码的复杂度系数，高码率视频需要更多解码算力</li>
                    <li><strong>GPU利用率：</strong>实际GPU算力利用效率，受驱动、框架等影响，通常70-85%</li>
                    <li><strong>Batch并行效率：</strong>多路视频批处理的效率系数，通常80-90%</li>
                    <li><strong>后处理开销：</strong>NMS、跟踪等后处理算法占用的额外计算资源</li>
                    <li><strong>计算结果：</strong>显示了不同GPU型号所需的卡数，建议选择卡数为整数且性价比高的方案</li>
                </ul>
                <h4 style="margin-top: 15px; color: #1976d2;">H264解码算力说明</h4>
                <ul>
                    <li>H264解码算力基于1080p@30fps标准复杂度为0.02 TFLOPS的基准计算</li>
                    <li>解码算力与分辨率、帧率和编码复杂度成正比关系</li>
                    <li>4K视频解码算力约为1080p的2.25倍</li>
                    <li>高码率视频（如监控录像）的复杂度系数更高</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const gpuSpecs = {
            'H100': { fp16: 1979, name: 'NVIDIA H100', tier: 1 },
            'A100': { fp16: 312, name: 'NVIDIA A100', tier: 2 },
            'L40': { fp16: 181, name: 'NVIDIA L40', tier: 3 },
            'RTX4090': { fp16: 165, name: 'NVIDIA RTX 4090', tier: 3 },
            'A30': { fp16: 165, name: 'NVIDIA A30', tier: 3 },
            'A40': { fp16: 149.7, name: 'NVIDIA A40', tier: 3 },
            'A10': { fp16: 125, name: 'NVIDIA A10', tier: 4 },
            'L4': { fp16: 121, name: 'NVIDIA L4', tier: 4 },
            'RTX4080': { fp16: 112, name: 'NVIDIA RTX 4080', tier: 4 },
            'V100': { fp16: 112, name: 'NVIDIA V100', tier: 4 },
            'RTX4070Ti': { fp16: 80, name: 'NVIDIA RTX 4070 Ti', tier: 5 },
            'RTX3090Ti': { fp16: 80, name: 'NVIDIA RTX 3090 Ti', tier: 5 },
            'RTX3090': { fp16: 71, name: 'NVIDIA RTX 3090', tier: 5 },
            'A16': { fp16: 71.2, name: 'NVIDIA A16', tier: 5 },
            'RTX3080Ti': { fp16: 68, name: 'NVIDIA RTX 3080 Ti', tier: 5 },
            'RTX4070': { fp16: 67, name: 'NVIDIA RTX 4070', tier: 5 },
            'T4': { fp16: 65, name: 'NVIDIA T4', tier: 6 },
            'RTX3080': { fp16: 60, name: 'NVIDIA RTX 3080', tier: 6 },
            'RTX4060Ti': { fp16: 44, name: 'NVIDIA RTX 4060 Ti', tier: 6 },
            'RTX3070': { fp16: 41, name: 'NVIDIA RTX 3070', tier: 6 }
        };

        // 更新滑块显示值
        document.getElementById('utilization').addEventListener('input', function(e) {
            document.getElementById('utilizationValue').textContent = e.target.value + '%';
        });

        document.getElementById('batch').addEventListener('input', function(e) {
            document.getElementById('batchValue').textContent = e.target.value + '%';
        });

        document.getElementById('overhead').addEventListener('input', function(e) {
            document.getElementById('overheadValue').textContent = e.target.value + '%';
        });

        // 视频解码选项切换
        document.getElementById('videoDecode').addEventListener('change', function(e) {
            const decodeSection = document.getElementById('decodeSection');
            if (e.target.value === 'true') {
                decodeSection.style.display = 'block';
            } else {
                decodeSection.style.display = 'none';
            }
        });

        function calculate() {
            const streams = parseInt(document.getElementById('streams').value);
            const modelFlops = parseFloat(document.getElementById('model').value);
            const resolution = parseFloat(document.getElementById('resolution').value);
            const fps = parseInt(document.getElementById('fps').value);
            const utilization = parseFloat(document.getElementById('utilization').value) / 100;
            const batchEff = parseFloat(document.getElementById('batch').value) / 100;
            const overhead = 1 - (parseFloat(document.getElementById('overhead').value) / 100);
            
            // 获取视频解码参数
            const videoDecode = document.getElementById('videoDecode').value === 'true';
            let decodePowerPerStream = 0;
            let decodeResolution = 0;
            let decodeFps = 0;
            let decodeComplexity = 0;
            
            if (videoDecode) {
                decodeResolution = parseFloat(document.getElementById('decodeResolution').value);
                decodeFps = parseInt(document.getElementById('decodeFps').value);
                decodeComplexity = parseFloat(document.getElementById('decodeComplexity').value);
                
                // H264解码算力计算 (基于像素处理能力和复杂度)
                // 基准: 1080p@30fps 标准复杂度 ≈ 0.02 TFLOPS
                const baseDecodePower = 0.02; // 1080p@30fps基准算力
                decodePowerPerStream = baseDecodePower * decodeResolution * (decodeFps / 30) * decodeComplexity;
            }

            // 计算单路视频所需算力 (TFLOPS) - AI推理 + 解码
            const aiPowerPerStream = (modelFlops * resolution * fps) / 1000;
            const singleStreamPower = aiPowerPerStream + decodePowerPerStream;

            // 计算总算力需求
            const totalPowerNeeded = singleStreamPower * streams;

            // 综合效率系数
            const efficiencyFactor = utilization * batchEff * overhead;

            // 显示计算公式
            document.getElementById('formulaBox').style.display = 'block';
            
            let step1Html = '';
            if (videoDecode && decodePowerPerStream > 0) {
                const decodeResolutionName = document.getElementById('decodeResolution').selectedOptions[0].text.split('(')[0].trim();
                const decodeComplexityName = document.getElementById('decodeComplexity').selectedOptions[0].text.split('(')[0].trim();
                
                step1Html = `
                    <strong>AI推理算力:</strong><br>
                    AI算力 = (模型FLOPs × 分辨率系数 × FPS) / 1000<br>
                    = (${modelFlops} × ${resolution} × ${fps}) / 1000<br>
                    = <span class="highlight">${aiPowerPerStream.toFixed(3)} TFLOPS</span><br><br>
                    
                    <strong>H264解码算力:</strong><br>
                    解码算力 = 基准算力 × 解码分辨率系数 × (解码FPS/30) × 复杂度系数<br>
                    = 0.02 × ${decodeResolution} × (${decodeFps}/30) × ${decodeComplexity}<br>
                    = <span class="highlight">${decodePowerPerStream.toFixed(3)} TFLOPS</span><br><br>
                    
                    <strong>单路总算力:</strong><br>
                    单路算力 = AI算力 + 解码算力<br>
                    = ${aiPowerPerStream.toFixed(3)} + ${decodePowerPerStream.toFixed(3)}<br>
                    = <span class="highlight">${singleStreamPower.toFixed(3)} TFLOPS</span>
                `;
            } else {
                step1Html = `
                    单路算力 = (模型FLOPs × 分辨率系数 × FPS) / 1000<br>
                    = (${modelFlops} × ${resolution} × ${fps}) / 1000<br>
                    = <span class="highlight">${singleStreamPower.toFixed(3)} TFLOPS</span>
                `;
            }
            
            document.getElementById('step1').innerHTML = step1Html;

            document.getElementById('step2').innerHTML = `
                总算力需求 = 单路算力 × 视频路数<br>
                = ${singleStreamPower.toFixed(3)} × ${streams}<br>
                = <span class="highlight">${totalPowerNeeded.toFixed(2)} TFLOPS</span>
            `;

            document.getElementById('step3').innerHTML = `
                单卡可用算力 = GPU理论算力 × 效率系数<br>
                效率系数 = GPU利用率 × Batch效率 × (1 - 后处理开销)<br>
                = ${(utilization*100).toFixed(0)}% × ${(batchEff*100).toFixed(0)}% × ${(overhead*100).toFixed(0)}%<br>
                = <span class="highlight">${(efficiencyFactor*100).toFixed(1)}%</span>
            `;

            document.getElementById('step4').innerHTML = `
                所需GPU卡数 = 总算力需求 / (GPU理论算力 × 效率系数)<br>
                = ${totalPowerNeeded.toFixed(2)} / (GPU理论算力 × ${(efficiencyFactor*100).toFixed(1)}%)<br>
                <span class="highlight">结果见下方GPU卡表</span>
            `;

            // 生成GPU卡片
            const gpuCardsHtml = Object.entries(gpuSpecs).map(([key, spec]) => {
                const availablePower = spec.fp16 * efficiencyFactor;
                const cardsNeeded = totalPowerNeeded / availablePower;
                const cardsNeededCeil = Math.ceil(cardsNeeded);

                return `
                    <div class="gpu-card">
                        <h3>${spec.name}</h3>
                        <div class="spec">
                            <span class="spec-label">理论算力</span>
                            <span class="spec-value">${spec.fp16} TFLOPS</span>
                        </div>
                        <div class="spec">
                            <span class="spec-label">可用算力</span>
                            <span class="spec-value">${availablePower.toFixed(1)} TFLOPS</span>
                        </div>
                        <div class="spec">
                            <span class="spec-label">单卡支持路数</span>
                            <span class="spec-value">${Math.floor(availablePower / singleStreamPower)} 路</span>
                        </div>
                        <div class="card-count">
                            <div class="card-count-label">所需卡数</div>
                            <div class="card-count-value">
                                ${cardsNeededCeil}
                                <span class="card-count-unit">张</span>
                            </div>
                            <div class="card-count-label" style="margin-top: 5px; font-size: 0.85em;">
                                (精确值: ${cardsNeeded.toFixed(2)})
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('gpuCards').innerHTML = gpuCardsHtml;

            // 生成摘要
            const modelName = document.getElementById('model').selectedOptions[0].text.split('(')[0].trim();
            const resolutionName = document.getElementById('resolution').selectedOptions[0].text.split('(')[0].trim();

            let summaryHtml = `
                处理 <span class="highlight">${streams} 路</span>视频流，
                分辨率 <span class="highlight">${resolutionName}</span>，
                帧率 <span class="highlight">${fps} FPS</span>，
                使用 <span class="highlight">${modelName}</span>模型，`;
            
            if (videoDecode && decodePowerPerStream > 0) {
                const decodeResolutionName = document.getElementById('decodeResolution').selectedOptions[0].text.split('(')[0].trim();
                summaryHtml += `
                包含H264解码 (${decodeResolutionName}@${decodeFps}fps)，`;
            }
            
            summaryHtml += `
                总算力需求为 <span class="highlight">${totalPowerNeeded.toFixed(2)} TFLOPS</span>。
                <br><br>
                考虑到 ${(efficiencyFactor*100).toFixed(1)}% 的综合效率系数，`;
            
            if (videoDecode && decodePowerPerStream > 0) {
                summaryHtml += `
                每路视频需要 <span class="highlight">${singleStreamPower.toFixed(3)} TFLOPS</span> 算力
                (AI推理: ${aiPowerPerStream.toFixed(3)} TFLOPS + 解码: ${decodePowerPerStream.toFixed(3)} TFLOPS)。`;
            } else {
                summaryHtml += `
                每路视频需要 <span class="highlight">${singleStreamPower.toFixed(3)} TFLOPS</span> 算力。`;
            }

            document.getElementById('summaryText').innerHTML = summaryHtml;

            // 显示结果
            document.getElementById('results').style.display = 'block';

            // 滚动到结果
            document.getElementById('formulaBox').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>